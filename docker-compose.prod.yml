# Fast Data Agent - 生产环境 Docker Compose 覆盖配置
# 使用方式：docker compose -f docker-compose.yml -f docker-compose.prod.yml up -d
#
# 注意：生产环境必须设置以下环境变量：
#   - SECRET_KEY: 安全的随机密钥
#   - REFRESH_SECRET_KEY: 安全的刷新令牌密钥
#   - OPENAI_API_KEY: OpenAI API 密钥

services:
  app:
    build:
      context: .
      target: runtime  # 使用精简的运行时镜像
    environment:
      # 生产环境配置
      - ENVIRONMENT=production
      - DEBUG=false
      - LOG_LEVEL=INFO
      - ENABLE_DOCS=false  # 生产环境禁用 API 文档
      # 安全密钥（必须从外部传入）
      - SECRET_KEY=${SECRET_KEY:?生产环境必须设置 SECRET_KEY}
      - REFRESH_SECRET_KEY=${REFRESH_SECRET_KEY:?生产环境必须设置 REFRESH_SECRET_KEY}
    restart: unless-stopped

  postgres:
    restart: unless-stopped

  minio:
    restart: unless-stopped

  sandbox:
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '4'
          memory: 2G  # 生产环境增加资源限制

