# ğŸ”¥ Fast Data Agent ä»£ç æ¯’èˆŒè¯„å®¡

> "ä»£ç å†™å¾—å¥½ä¸å¥½ï¼Œå–·ä¸€å–·å°±çŸ¥é“äº†" â€”â€” æŸåŒ¿åä»£ç å–·å­

---

## ğŸ“‹ æ€»ä½“è¯„ä»·

ä»£ç æ•´ä½“è´¨é‡ï¼š**åŠæ ¼åä¸Š** â­â­â­

ä¼˜ç‚¹ï¼šæ¶æ„æ¸…æ™°ã€åˆ†å±‚åˆç†ã€æ–‡æ¡£é½å…¨
ç¼ºç‚¹ï¼šç»†èŠ‚æ¬ è€ƒè™‘ã€å­˜åœ¨å¤šå¤„è®¾è®¡ç¼ºé™·ã€å‰åç«¯åè°ƒä¸å¤Ÿ

---

## ğŸ¯ åç«¯é—®é¢˜

### 1. å¯¼å…¥æ”¾ä¸­é—´ï¼ŒPython çœ‹äº†éƒ½æµæ³ª ğŸ˜­

**æ–‡ä»¶**: `app/services/chat.py`

```python
class LLMCache:
    # ... ä¸€å¤§å †ä»£ç  ...
    @classmethod
    def clear(cls) -> None:
        """æ¸…ç©ºç¼“å­˜"""
        cls._instances.clear()
from app.models.session import AnalysisSession  # ğŸ’¥ å¯¼å…¥æ”¾è¿™é‡Œï¼Ÿï¼Ÿï¼Ÿ
from app.models.message import ChatMessage
```

**é—®é¢˜**: å¯¼å…¥è¯­å¥æ”¾åœ¨ç±»å®šä¹‰ä¹‹åï¼è¿™æ˜¯ä»€ä¹ˆéªšæ“ä½œï¼ŸPEP 8 è§„èŒƒï¼šæ‰€æœ‰å¯¼å…¥åº”è¯¥æ”¾åœ¨æ–‡ä»¶å¼€å¤´ã€‚

**ä¿®å¤**: æŠŠæ‰€æœ‰å¯¼å…¥ç§»åˆ°æ–‡ä»¶é¡¶éƒ¨ï¼Œåˆ«æè¿™ç§éä¸»æµã€‚

---

### 2. LLMCache æ˜¯ä¸ªå®šæ—¶ç‚¸å¼¹ ğŸ’£

```python
class LLMCache:
    _instances: dict[float, ChatOpenAI] = {}  # ç±»å˜é‡ï¼Œå…¨å±€å…±äº«
```

**é—®é¢˜**: 
1. å…¨å±€å•ä¾‹ï¼Œå¤šç”¨æˆ·å¹¶å‘æ—¶å…±äº«åŒä¸€ä¸ª LLM å®ä¾‹
2. `temperature` ä½œä¸º key å¤ªç²—ç³™ï¼Œä¸åŒ API key æ€ä¹ˆåŠï¼Ÿ
3. æ²¡æœ‰è¿‡æœŸæœºåˆ¶ï¼Œå†…å­˜æ³„æ¼è­¦å‘Šï¼

**å»ºè®®**: è¦ä¹ˆç”¨çº¿ç¨‹å®‰å…¨çš„ç¼“å­˜åº“ï¼ˆå¦‚ `cachetools`ï¼‰ï¼Œè¦ä¹ˆæ¯è¯·æ±‚åˆ›å»ºï¼ˆåæ­£ LLM è°ƒç”¨æœ¬èº«å°±æ…¢ï¼‰ã€‚

---

### 3. é™é»˜åæ‰å¼‚å¸¸ï¼Œdebug æ—¶æƒ³å“­ ğŸ˜¢

**æ–‡ä»¶**: `app/services/recommend.py`

```python
try:
    recommendations = await self._generate_with_llm(...)
except (ValidationError, Exception):
    pass  # ğŸ’¥ ä»€ä¹ˆéƒ½ä¸è¯´å°± pass äº†ï¼Ÿ
```

**é—®é¢˜**: 
- `except Exception` å·²ç»å¤Ÿå®½äº†ï¼Œè¿˜è¦ `pass`ï¼Ÿ
- LLM è°ƒç”¨å¤±è´¥ï¼Ÿç½‘ç»œè¶…æ—¶ï¼ŸAPI é™æµï¼Ÿç»Ÿç»Ÿå½“æ²¡å‘ç”Ÿï¼
- è°ƒè¯•æ—¶ï¼šä¸ºä»€ä¹ˆæ¨èæ€»æ˜¯é‚£å‡ ä¸ªï¼Ÿï¼ˆå› ä¸º LLM è°ƒç”¨ä¸€ç›´åœ¨æŠ¥é”™ï¼ï¼‰

**ä¿®å¤å**: å·²æ·»åŠ æ—¥å¿—ï¼Œä½†è¿™ç§å†™æ³•ä¸€å¼€å§‹å°±ä¸åº”è¯¥å‡ºç°ã€‚

---

### 4. æ•°æ®åº“å¯†ç æ˜æ–‡ä¼ é€’ ğŸ”“

**æ–‡ä»¶**: `app/utils/tools.py`

```python
ctx_data["password"] = ds.password  # ç›´æ¥ä¼ å¯†ç 
```

**é—®é¢˜**: æ•°æ®åº“å¯†ç åœ¨ä»£ç ä¸­åˆ°å¤„ä¼ é€’ï¼Œä» `DataSource` â†’ `DataSourceContext` â†’ æ²™ç›’ã€‚è™½ç„¶æ˜¯å†…éƒ¨é€šä¿¡ï¼Œä½†ï¼š
1. æ—¥å¿—å¯èƒ½æ‰“å°å‡ºæ¥ï¼ˆlogger.debug ä¼šæš´éœ²ï¼‰
2. æ²™ç›’æ˜¯å¦ä¸€ä¸ªæœåŠ¡ï¼Œç½‘ç»œä¼ è¾“æ²¡åŠ å¯†

**å»ºè®®**: ä½¿ç”¨ä¸´æ—¶å‡­è¯æˆ–åŠ å¯†ä¼ è¾“ã€‚

---

### 5. BaseRepository çš„ hasattr åå°„åœ°ç‹± ğŸ‘º

**æ–‡ä»¶**: `app/repositories/base.py`

```python
if hasattr(self.model, "deleted"):
    query = query.where(self.model.deleted == 0)  # type: ignore
```

åˆ°å¤„éƒ½æ˜¯ `hasattr`ï¼Œåˆ°å¤„éƒ½æ˜¯ `# type: ignore`ã€‚

**é—®é¢˜**:
1. è¿è¡Œæ—¶åå°„ï¼ŒIDE æ— æ³•æ£€æŸ¥
2. `type: ignore` è¯´æ˜ç±»å‹ç³»ç»Ÿå·²ç»æ”¾å¼ƒ
3. å¦‚æœå­ç±»æ¨¡å‹æ”¹äº†å­—æ®µåï¼Œè¿™é‡Œä¸ä¼šæŠ¥é”™ï¼Œåªä¼šé»˜é»˜å¤±è´¥

**å»ºè®®**: ä½¿ç”¨ Mixin æˆ–è€…åè®®ï¼ˆProtocolï¼‰æ¥çº¦æŸæ¨¡å‹å­—æ®µã€‚

---

### 6. æ¨èç”Ÿæˆçš„ "æ™ºèƒ½" é™çº§ ğŸ¤–â†’ğŸ“œ

```python
if not schema_info:
    return self._get_generic_recommendations()  # è¿”å›å†™æ­»çš„æ¨è
```

**é—®é¢˜**: 
- æ•°æ®æºæ²¡æœ‰ Schemaï¼Ÿè¿”å›å›ºå®šæ¨è
- LLM è°ƒç”¨å¤±è´¥ï¼Ÿè¿”å›å›ºå®šæ¨è
- è¿”å›ç©ºåˆ—è¡¨ï¼Ÿè¿”å›å›ºå®šæ¨è

ç”¨æˆ·ï¼šä¸ºä»€ä¹ˆæ¨èæ€»æ˜¯ "æŸ¥çœ‹æ•°æ®æ¦‚è§ˆ"ã€"æ•°æ®è´¨é‡æ£€æŸ¥"ï¼Ÿ
ç³»ç»Ÿï¼šï¼ˆæ²‰é»˜ï¼‰

**å»ºè®®**: ç»™ç”¨æˆ·ä¸€ä¸ªæç¤ºï¼š"æœªèƒ½è·å–æ•°æ®ç»“æ„ï¼Œæ˜¾ç¤ºé€šç”¨æ¨è"

---

## ğŸ¨ å‰ç«¯é—®é¢˜

### 1. ChatMessageResponse ç¼ºå­—æ®µï¼Œå›¾è¡¨å°±æ¶ˆå¤±äº† ğŸ‘»

**æ–‡ä»¶**: `app/schemas/message.py` (åŸæœ¬)

```python
class ChatMessageResponse(BaseModel):
    # ... ä¸€å †å­—æ®µ ...
    # artifact å‘¢ï¼Ÿï¼Ÿï¼Ÿ
```

**é—®é¢˜**: åç«¯æ•°æ®åº“æœ‰ `artifact` å­—æ®µï¼Œä½† API Schema æ²¡æœ‰ï¼Œå¯¼è‡´ï¼š
1. SSE æµä¸­èƒ½çœ‹åˆ°å›¾è¡¨
2. åˆ·æ–°é¡µé¢åå›¾è¡¨æ¶ˆå¤±
3. å¼€å‘è€…ï¼šè¿™æ˜¯ä»€ä¹ˆç„å­¦ï¼Ÿ

**æ•™è®­**: Schema å’Œ Model è¦ä¿æŒåŒæ­¥ï¼Œå†™å®Œ Model å°±è¯¥å†™ Schemaã€‚

---

### 2. æ¶ˆæ¯åŒæ­¥é€»è¾‘åƒåœ¨è·³æ¢æˆˆ ğŸ’ƒ

**æ–‡ä»¶**: `web/src/pages/Chat.tsx` (ä¿®å¤å‰)

```javascript
useEffect(() => {
    if (apiMessages.length > 0) {  // ç©ºæ•°ç»„å°±ä¸æ‰§è¡Œï¼Ÿ
        setLocalMessages(...);
    }
}, [apiMessages]);  // æ¯æ¬¡éƒ½æ˜¯æ–°æ•°ç»„ï¼Œæ¯æ¬¡éƒ½è§¦å‘
```

**é—®é¢˜**:
1. `apiMessages` æ˜¯æ´¾ç”Ÿå€¼ï¼Œæ¯æ¬¡æ¸²æŸ“éƒ½æ˜¯æ–°å¼•ç”¨
2. æ¡ä»¶åˆ¤æ–­ `length > 0` å¯¼è‡´ç©ºä¼šè¯ä¸åŒæ­¥
3. ä¾èµ–é¡¹é€‰æ‹©é”™è¯¯å¯¼è‡´æ— é™å¾ªç¯æˆ–ä¸æ›´æ–°

**ä¿®å¤å**: ä½¿ç”¨ç¨³å®šå¼•ç”¨ + æ­£ç¡®çš„ä¾èµ–é¡¹

---

### 3. orval ç”Ÿæˆçš„ç±»å‹ï¼Œæ‰‹åŠ¨ä¿®æ”¹ï¼ŸğŸ¤¦

**æ–‡ä»¶**: `web/src/api/fastDataAgent.ts`

```typescript
// Generated by orval v8.0.0-rc.2 ğŸº
// Do not edit manually.  // ğŸ’¥ æˆ‘ä»¬åˆšæ‰æ”¹äº†ï¼
```

**é—®é¢˜**: ç”Ÿæˆçš„æ–‡ä»¶ä¸è¯¥æ‰‹åŠ¨ä¿®æ”¹ï¼Œåº”è¯¥ï¼š
1. ä¿®æ”¹åç«¯ Schema
2. é‡æ–°ç”Ÿæˆå‰ç«¯ç±»å‹
3. ä¿æŒç±»å‹åŒæ­¥

**ç°çŠ¶**: æ‰‹åŠ¨åŠ äº† `artifact` å­—æ®µï¼Œä¸‹æ¬¡é‡æ–°ç”Ÿæˆå°±ä¸¢äº†ã€‚

---

### 4. useCallback ä¾èµ–é¡¹ç‚¸å¼¹ ğŸ’£

```javascript
const handleSend = useCallback(async (messageContent?: string) => {
    // 100+ è¡Œä»£ç 
}, [input, isGenerating, sessionId, addMessage, toast, t, queryClient, refetchMessages]);
```

**é—®é¢˜**: 
1. ä¾èµ–é¡¹å¤ªå¤šï¼Œå®¹æ˜“æ¼æ‰
2. å‡½æ•°ä½“å¤ªé•¿ï¼Œåº”è¯¥æ‹†åˆ†
3. `t` (ç¿»è¯‘å‡½æ•°) çœŸçš„éœ€è¦ä½œä¸ºä¾èµ–å—ï¼Ÿ

**å»ºè®®**: 
- æ‹†åˆ†å¤§å‡½æ•°
- ä½¿ç”¨ useReducer ç®¡ç†å¤æ‚çŠ¶æ€
- è€ƒè™‘è‡ªå®šä¹‰ Hook

---

### 5. æ¨èå¡ç‰‡é‡å¤æ˜¾ç¤ºçš„æ ¹æº ğŸ”„

**åç«¯**: `force_regenerate` åªåˆ é™¤ `initial` ç±»å‹
**å‰ç«¯**: æ¯æ¬¡ AI å›å¤éƒ½ç”Ÿæˆ `followup` æ¨è

ç»“æœï¼š`followup` æ¨èæ— é™ç´¯ç§¯ï¼ŒUI è¶Šæ¥è¶Šé•¿ã€‚

**ä¿®å¤å**: ç°åœ¨ä¼šåˆ é™¤æ—§çš„ followupï¼Œä½†è¿™ç§å‰åç«¯ä¸åè°ƒçš„é—®é¢˜æœ¬ä¸è¯¥å‘ç”Ÿã€‚

---

## ğŸ—ï¸ æ¶æ„é—®é¢˜

### 1. æ²™ç›’æœåŠ¡æ˜¯ä¸ªé»‘ç›’ ğŸ“¦

æ²™ç›’æœåŠ¡å•ç‹¬è¿è¡Œï¼Œä½†ï¼š
1. é”™è¯¯å¤„ç†ä¸å¤Ÿè¯¦ç»†
2. æ²¡æœ‰å¥åº·æ£€æŸ¥
3. è¶…æ—¶æ—¶é—´å†™æ­» `settings.SANDBOX_TIMEOUT`

å¦‚æœæ²™ç›’æŒ‚äº†ï¼Œç”¨æˆ·åªä¼šçœ‹åˆ° "æœªçŸ¥é”™è¯¯"ã€‚

---

### 2. ä¼šè¯çŠ¶æ€åˆ†æ•£å­˜å‚¨ ğŸ—ƒï¸

- æ¶ˆæ¯ï¼šæ•°æ®åº“
- æ¨èï¼šæ•°æ®åº“
- æ–‡ä»¶ï¼šMinIO + æ²™ç›’
- LLM ä¸Šä¸‹æ–‡ï¼šæ¯æ¬¡é‡å»º

**é—®é¢˜**: æ²¡æœ‰ç»Ÿä¸€çš„ä¼šè¯çŠ¶æ€ç®¡ç†ï¼Œæ¢å¤ä¼šè¯æ—¶éœ€è¦ä»å¤šä¸ªåœ°æ–¹æ‹¼å‡‘æ•°æ®ã€‚

---

### 3. å‰åç«¯ç±»å‹ä¸åŒæ­¥ ğŸ”—

- åç«¯ï¼šPydantic Schema
- å‰ç«¯ï¼šorval ç”Ÿæˆçš„ TypeScript ç±»å‹
- æ²™ç›’ï¼šè‡ªå·±å®šä¹‰çš„ dict

ä¸‰æ–¹å„è¯´å„è¯ï¼Œç»å¸¸å‡ºç°å­—æ®µé—æ¼ã€‚

**å»ºè®®**: å»ºç«‹ Schema å˜æ›´çš„ CI æ£€æŸ¥ã€‚

---

## ğŸ”§ æ²™ç›’æœåŠ¡ - ä¸€ä¸ªäººçš„å­¤å²›

### 1. exec() ç›´æ¥æ‰§è¡Œç”¨æˆ·ä»£ç ï¼Œèƒ†å­çœŸå¤§ï¼ ğŸ²

**æ–‡ä»¶**: `sandbox_runtime/main.py`

```python
exec(request.code, exec_globals)  # ç”¨æˆ·ä»£ç ç›´æ¥ exec
```

**é—®é¢˜**: 
- è™½ç„¶è·‘åœ¨ Docker é‡Œï¼Œä½†æ²¡æœ‰ä»»ä½•ä»£ç å®¡æŸ¥
- æ¶æ„ä»£ç å¯ä»¥ï¼šæ— é™å¾ªç¯ã€åƒå…‰å†…å­˜ã€Fork ç‚¸å¼¹
- è¶…æ—¶é è°ƒç”¨æ–¹æ§åˆ¶ï¼Œæ²™ç›’è‡ªå·±ä¸ç®¡

**å»ºè®®**: 
- ä½¿ç”¨ RestrictedPython é™åˆ¶å¯ç”¨å‡½æ•°
- æ·»åŠ èµ„æºé™åˆ¶ï¼ˆCPUã€å†…å­˜ã€æ–‡ä»¶æ•°ï¼‰
- ä»£ç é™æ€åˆ†æè¿‡æ»¤å±é™©æ“ä½œ

---

### 2. DuckDB è¿æ¥ä¸å…³é—­ï¼Œè¿æ¥æ± å˜åºŸé“ ğŸ”©

```python
def get_connection(self, with_s3: bool = False):
    conn = duckdb.connect(":memory:")  # æ¯æ¬¡åˆ›å»ºæ–°è¿æ¥
    # ... é…ç½®ä¸€å †ä¸œè¥¿ ...
    return conn  # è°ƒç”¨æ–¹è¦è®°å¾—å…³ï¼
```

**é—®é¢˜**: 
- è¿”å›è£¸è¿æ¥ï¼Œè°ƒç”¨æ–¹å¿˜è®° `close()` å°±æ³„æ¼äº†
- `DuckDBConnectionManager` å…¶å®ä¸ç®¡ç†è¿æ¥ï¼Œåªç®¡ç†æ‰©å±•
- åå­—å« Manager ä½†ä¸ manage è¿æ¥ï¼Œå±äºè¯ˆéª—

**å»ºè®®**: ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨ `@contextmanager`

---

### 3. äº”ç§æ–¹æ³•ä¸‹è½½ SQLiteï¼Œå®æ„¿é‡å¤ä¹Ÿä¸æŠ½è±¡ ğŸ”„

```python
try:
    from minio import Minio
    # æ–¹æ³•1: minio SDK
except ImportError:
    try:
        import boto3
        # æ–¹æ³•2: boto3
    except ImportError:
        try:
            result = conn.execute(f"SELECT content FROM read_blob...")
            # æ–¹æ³•3: DuckDB read_blob
        except:
            # æ”¾å¼ƒ
```

**é—®é¢˜**: 80 è¡Œä»£ç å°±ä¸ºäº†ä¸‹è½½ä¸€ä¸ªæ–‡ä»¶ã€‚

**å»ºè®®**: é€‰ä¸€ä¸ªåº“ï¼Œå†™è¿› requirementsï¼Œåˆ æ‰å…¶ä»–æ–¹æ¡ˆã€‚

---

## ğŸ—„ï¸ æ•°æ®åº“å’Œå­˜å‚¨ - ç»†èŠ‚è—é­”é¬¼

### 1. è½¯åˆ é™¤å†™æ­» deleted=0/1 ğŸª¦

```python
deleted: Mapped[int] = mapped_column(Integer, default=0, comment="é€»è¾‘åˆ é™¤(0:æœªåˆ é™¤ 1:å·²åˆ é™¤)")
```

**é—®é¢˜**:
- ç”¨ `int` è€Œä¸æ˜¯ `bool`ï¼ŒæŸ¥è¯¢æ—¶è¦å†™ `deleted == 0`
- æ²¡æœ‰ `deleted_at` æ—¶é—´æˆ³ï¼Œä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™åˆ çš„
- ç¡¬åˆ é™¤å’Œè½¯åˆ é™¤æ··ç”¨ï¼ˆæœ‰çš„åœ°æ–¹ç›´æ¥ `db.delete()`ï¼‰

---

### 2. JWT Secret Key é»˜è®¤å€¼ ğŸ”

**æ–‡ä»¶**: `app/core/config.py`

```python
SECRET_KEY: str = "your-secret-key-here-change-in-production"
```

**é—®é¢˜**: 
- é»˜è®¤å€¼å°±æ˜¯ä¸€ä¸ªæç¤ºå­—ç¬¦ä¸²...
- å¦‚æœå¿˜äº†æ”¹ï¼Œæ‰€æœ‰ç¯å¢ƒç”¨åŒä¸€ä¸ªå¯†é’¥
- æ”»å‡»è€…åªè¦ Google ä¸€ä¸‹å°±çŸ¥é“å¯†é’¥

**å»ºè®®**: å¯åŠ¨æ—¶æ£€æŸ¥ï¼Œå¦‚æœæ˜¯é»˜è®¤å€¼å°±æ‹’ç»å¯åŠ¨ã€‚

---

### 3. bcrypt rounds æµ‹è¯•æ—¶é™åˆ° 4 âš¡

```python
_BCRYPT_ROUNDS = 4 if os.getenv("TESTING") == "1" else 12
```

**é—®é¢˜**: 
- ç¯å¢ƒå˜é‡åˆ¤æ–­ï¼Œå®¹æ˜“åœ¨ç”Ÿäº§ç¯å¢ƒè¯¯è®¾
- rounds=4 çš„å“ˆå¸Œ 0.01 ç§’å°±èƒ½æš´åŠ›ç ´è§£

**å»ºè®®**: ç”¨é…ç½®æ–‡ä»¶è€Œä¸æ˜¯é­”æ³•ç¯å¢ƒå˜é‡ã€‚

---

## ğŸ¨ å‰ç«¯æ·±åº¦åæ§½

### 1. storage.ts - any æ»¡å¤©é£ âœ¨

```typescript
setUser: (user: any) => localStorage.setItem('user', JSON.stringify(user)),
```

**é—®é¢˜**: 
- `any` ç±»å‹ï¼Œå•¥éƒ½èƒ½å­˜
- å­˜è¿›å» `{id: 1}`ï¼Œå–å‡ºæ¥ `{username: "x"}`ï¼Œç±»å‹ç³»ç»Ÿæ‘†è®¾ï¼Ÿ
- æ²¡æœ‰é”™è¯¯å¤„ç†ï¼ŒJSON.parse å‡ºé”™å°±ç‚¸

---

### 2. axios æ‹¦æˆªå™¨å…¨å±€æ±¡æŸ“ ğŸŒ

**æ–‡ä»¶**: `web/src/api/config.ts`

```typescript
axios.defaults.baseURL = ...
axios.interceptors.request.use(...)
```

**é—®é¢˜**: 
- ç›´æ¥æ”¹ axios å…¨å±€é…ç½®
- å¦‚æœå…¶ä»–åº“ä¹Ÿç”¨ axiosï¼Œä¼šè¢«æ±¡æŸ“
- æµ‹è¯•æ—¶éš¾ä»¥ mock

**å»ºè®®**: åˆ›å»ºç‹¬ç«‹çš„ axios å®ä¾‹ã€‚

---

### 3. authStore çš„ logout ç”¨ window.location è·³è½¬ ğŸš€

```typescript
logout: () => {
    storage.clearAuth();
    window.location.href = '/web/login';  // å¼ºåˆ·é¡µé¢
}
```

**é—®é¢˜**: 
- React Router ç®¡ç†è·¯ç”±ï¼Œç»“æœç”¨ `window.location` è·³è½¬
- å…¨é¡µé¢åˆ·æ–°ï¼ŒSPA çš„æ„ä¹‰ä½•åœ¨ï¼Ÿ
- è·¯å¾„ç¡¬ç¼–ç  `/web/login`

**å»ºè®®**: ä½¿ç”¨ React Router çš„ `navigate`ã€‚

---

### 4. App.tsx æ¯ä¸ªè·¯ç”±éƒ½åŒ… ProtectedRoute ğŸ”’

```tsx
<Route path="/" element={<ProtectedRoute><Layout><Dashboard /></Layout></ProtectedRoute>} />
<Route path="/data-sources" element={<ProtectedRoute><Layout><DataSources /></Layout></ProtectedRoute>} />
<Route path="/sessions" element={<ProtectedRoute><Layout><Sessions /></Layout></ProtectedRoute>} />
```

**é—®é¢˜**: 
- é‡å¤ä»£ç 
- åµŒå¥—å±‚çº§æ·±
- æ–°å¢é¡µé¢è¦æŠ„ä¸€é

**å»ºè®®**: ä½¿ç”¨è·¯ç”±åµŒå¥—å’Œ Outletã€‚

---

### 5. ChatMessage ç»„ä»¶çš„ artifact ç±»å‹ä¸å®Œæ•´ ğŸ“Š

```typescript
artifact?: {
    type: string;  // åªçŸ¥é“æ˜¯ string
    chart_json?: string;
    // ... å…¶ä»–å­—æ®µéƒ½æ˜¯å¯é€‰
}
```

**é—®é¢˜**: 
- `type` ç”¨ string è€Œä¸æ˜¯è”åˆç±»å‹ `'plotly' | 'table' | 'error'`
- æ‰€æœ‰å­—æ®µéƒ½æ˜¯å¯é€‰ï¼Œç±»å‹ç³»ç»Ÿå½¢åŒè™šè®¾
- `switch (message.artifact.type)` æ²¡æœ‰ç©·ä¸¾æ£€æŸ¥

---

### 6. useMemo çš„ avatar ä¾èµ– isUser å’Œ isTool ğŸ¤”

```tsx
const avatar = useMemo(() => {
    if (isUser) return <User />;
    if (isTool) return <Wrench />;
    return <Bot />;
}, [isUser, isTool]);
```

**é—®é¢˜**: 
- `isUser` å’Œ `isTool` æ˜¯ä» props æ´¾ç”Ÿçš„å¸ƒå°”å€¼
- æ¯æ¬¡ `message` å˜äº†ï¼Œå®ƒä»¬å°±å˜äº†
- useMemo åœ¨è¿™é‡Œå¹¶æ²¡æœ‰ä¼˜åŒ–ä»€ä¹ˆ

**äº‹å®**: è¿™ä¸ª useMemo å‡ ä¹æ— æ•ˆï¼Œå› ä¸ºä¾èµ–é¡¹æ¯æ¬¡éƒ½å˜ã€‚

---

## ğŸ§ª æµ‹è¯•å’Œè´¨é‡

### 1. æ²¡æœ‰ç«¯åˆ°ç«¯æµ‹è¯• ğŸ”š

**ç°çŠ¶**: 
- å•å…ƒæµ‹è¯•æœ‰ä¸€äº›
- é›†æˆæµ‹è¯•é›¶æ˜Ÿ
- E2E æµ‹è¯•ä¸å­˜åœ¨

**åæœ**: åƒ "å›¾è¡¨æ¶ˆå¤±" è¿™ç§ bugï¼Œå•å…ƒæµ‹è¯•æ ¹æœ¬å‘ç°ä¸äº†ã€‚

---

### 2. Makefile å‘½ä»¤å¤ªç®€é™‹ ğŸ“„

```makefile
make test  # å°±è·‘ pytest
make check # lint + format + type-check
```

**ç¼ºå°‘**: 
- `make test-cov` è¦†ç›–ç‡
- `make test-e2e` ç«¯åˆ°ç«¯
- `make test-watch` ç›‘å¬æ¨¡å¼

---

## ğŸ–ï¸ ä¼˜ç‚¹ï¼ˆå…¬å¹³èµ·è§ï¼‰

1. **åˆ†å±‚æ¶æ„æ¸…æ™°**: Router â†’ Service â†’ Repository â†’ Model
2. **å¼‚æ­¥è®¾è®¡**: å…¨é“¾è·¯ async/awaitï¼Œæ€§èƒ½æœ‰ä¿éšœ
3. **ç±»å‹æ ‡æ³¨**: Python ç”¨äº†ç±»å‹æç¤ºï¼ŒTypeScript ä¹Ÿæœ‰ç±»å‹
4. **æ–‡æ¡£å®Œå–„**: AGENTS.mdã€API_DESIGN_REVIEW.md ç­‰
5. **å›½é™…åŒ–**: i18next æ”¯æŒä¸­è‹±æ–‡
6. **æ‡’åŠ è½½**: React.lazy() åšäº†ä»£ç æ‹†åˆ†
7. **SSE æµå¼**: èŠå¤©å“åº”å®æ—¶è¾“å‡ºï¼Œä½“éªŒä¸é”™

---

## ğŸ“ æ€»ç»“

### é—®é¢˜åˆ†ç±»ç»Ÿè®¡

| ç±»åˆ« | æ•°é‡ | ä¸¥é‡ç¨‹åº¦ |
|------|------|----------|
| å®‰å…¨é—®é¢˜ | 4 | ğŸ”´ é«˜ |
| è®¾è®¡ç¼ºé™· | 6 | ğŸŸ  ä¸­ |
| ä»£ç è§„èŒƒ | 8 | ğŸŸ¡ ä½ |
| æ€§èƒ½é—®é¢˜ | 3 | ğŸŸ¡ ä½ |
| å¯ç»´æŠ¤æ€§ | 5 | ğŸŸ  ä¸­ |

### æ ¸å¿ƒé—®é¢˜

è¿™ä¸ªé¡¹ç›®çš„éª¨æ¶æ­å¾—ä¸é”™ï¼Œä½†ç»†èŠ‚å¤„ç†ä¸å¤Ÿç”¨å¿ƒã€‚å¾ˆå¤šé—®é¢˜éƒ½æ˜¯"å·®ä¸€ç‚¹"ï¼š
- Schema å·®ä¸€ä¸ªå­—æ®µ â†’ å›¾è¡¨æ¶ˆå¤±
- ä¾èµ–é¡¹å·®ä¸€ä¸ªå˜é‡ â†’ æ¶ˆæ¯ä¸åŒæ­¥
- æ—¥å¿—å·®ä¸€è¡Œè¾“å‡º â†’ Debug æ— ä»ä¸‹æ‰‹
- ç±»å‹å·®ä¸€ä¸ªå®šä¹‰ â†’ any æ»¡å¤©é£

ä»£ç è´¨é‡åƒæ˜¯ "èƒ½è·‘å°±è¡Œ" çš„å¿ƒæ€ï¼Œç¼ºå°‘ "è®©å®ƒè·‘å¾—å¥½" çš„è¿½æ±‚ã€‚

### ç´§æ€¥éœ€è¦ä¿®å¤çš„

1. **å®‰å…¨**: JWT é»˜è®¤å¯†é’¥å¿…é¡»å¯åŠ¨æ—¶æ ¡éªŒ
2. **ç¨³å®š**: æ²™ç›’ exec() éœ€è¦èµ„æºé™åˆ¶
3. **ä½“éªŒ**: é”™è¯¯ä¿¡æ¯éœ€è¦ç”¨æˆ·å‹å¥½åŒ–

### ç»™ä½œè€…çš„å»ºè®®

1. **æµç¨‹**: å†™å®Œä¸€ä¸ªåŠŸèƒ½ï¼Œä»ç”¨æˆ·è§’åº¦èµ°ä¸€éå…¨æµç¨‹
2. **æµ‹è¯•**: æ·»åŠ ç«¯åˆ°ç«¯æµ‹è¯•ï¼Œè€Œä¸åªæ˜¯å•å…ƒæµ‹è¯•
3. **å®¡æŸ¥**: å»ºç«‹ä»£ç å®¡æŸ¥æœºåˆ¶ï¼Œå“ªæ€•æ˜¯è‡ªå·±å®¡è‡ªå·±
4. **ç±»å‹**: å‰åç«¯ç±»å‹åŒæ­¥ï¼Œå»ºç«‹ CI æ£€æŸ¥
5. **æ—¥å¿—**: å…³é”®è·¯å¾„åŠ æ—¥å¿—ï¼Œåˆ«è®© bug éšèº«

### æŠ€æœ¯å€ºä¼˜å…ˆçº§

```
ç´§æ€¥ & é‡è¦: å®‰å…¨ç›¸å…³ï¼ˆJWTå¯†é’¥ã€execé™åˆ¶ï¼‰
ç´§æ€¥ & ä¸é‡è¦: ç”¨æˆ·ä½“éªŒï¼ˆé”™è¯¯æç¤ºï¼‰
ä¸ç´§æ€¥ & é‡è¦: æ¶æ„ä¼˜åŒ–ï¼ˆç±»å‹åŒæ­¥ã€æµ‹è¯•è¦†ç›–ï¼‰
ä¸ç´§æ€¥ & ä¸é‡è¦: ä»£ç è§„èŒƒï¼ˆimporté¡ºåºã€å‘½åï¼‰
```

---

## ğŸ”® åç»­æ”¹è¿›è·¯çº¿å›¾

```
Phase 1: è¡¥æ´ï¼ˆ1å‘¨ï¼‰
â”œâ”€â”€ ä¿®å¤å®‰å…¨é—®é¢˜
â”œâ”€â”€ æ·»åŠ å…³é”®è·¯å¾„æ—¥å¿—
â””â”€â”€ å®Œå–„é”™è¯¯å¤„ç†

Phase 2: åŠ å›ºï¼ˆ2å‘¨ï¼‰
â”œâ”€â”€ ç«¯åˆ°ç«¯æµ‹è¯•
â”œâ”€â”€ ç±»å‹åŒæ­¥ CI
â””â”€â”€ ä»£ç è¦†ç›–ç‡ > 70%

Phase 3: ä¼˜åŒ–ï¼ˆæŒç»­ï¼‰
â”œâ”€â”€ æ€§èƒ½ç›‘æ§
â”œâ”€â”€ ä»£ç é‡æ„
â””â”€â”€ æ–‡æ¡£æ›´æ–°
```

---

*å–·å®Œäº†ï¼Œè¯·å‹¿å¯¹å·å…¥åº§ã€‚ä»£ç é—®é¢˜äººäººæœ‰ï¼Œæ”¹æ­£å°±æ˜¯å¥½åŒå¿—ã€‚* ğŸ«¡

---

**è¯„å®¡è€…**: AI Code Roaster v1.0  
**è¯„å®¡æ—¥æœŸ**: 2025-12-05  
**ä»£ç ç‰ˆæœ¬**: Fast Data Agentï¼ˆæœ€æ–° commitï¼‰

